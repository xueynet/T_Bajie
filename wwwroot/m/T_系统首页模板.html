<!DOCTYPE html>
<html>

<head>
    <stl:include file="/include/head.html"></stl:include>
</head>

<body>
    <!-- 头部的导航 -->
    <!--主体内容-->
    <div class="swiper-container swiper-container-bn">
        <div class="swiper-wrapper">
            <stl:contents channelName='banner'>
                <div class="swiper-slide">
                    <stl:a class="disblock"><img class="disblock w100" src="{content.ImageUrl}" /></stl:a>
                </div>
            </stl:contents>
        </div>
        <div class="swiper-pagination swiper-pagination-bn"></div>
    </div>
    <div class="md mt pt0">
        <div class="disflex flex_wrap">
            <stl:a channelName='算造价' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico1_03.png" />
                <p>算造价</p>
            </stl:a>
            <stl:a channelName='免费设计' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico2_03.png" />
                <p>免费设计</p>
            </stl:a>
            <stl:a channelName='别墅定制' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico3_03.png" />
                <p>别墅定制</p>
            </stl:a>
            <stl:a channelName='建房施工' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico4_03.png" />
                <p>建房施工</p>
            </stl:a>
            <stl:a channelIndex="render" class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico5_03.png" />
                <p>效果图</p>
            </stl:a>
            <stl:a channelName='户型设计' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico6_03.png" />
                <p>户型设计</p>
            </stl:a>
            <stl:a channelName='室内装修' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico7_03.png" />
                <p>室内装修</p>
            </stl:a>
            <stl:a channelName='服务' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico8_03.png" />
                <p>全部服务</p>
            </stl:a>
        </div>
    </div>
    <!--发布需求模板-->
    <div class="container">
        <div class="row xqtemp">
            <div class="xqtitle text-center col-12 mb-3">
                <h3><img class="hot" src="https://gc.zbj.com/images/hot.png">免费发布需求<img class="hot" src="https://gc.zbj.com/images/hot.png"></h3>
                <p>官方推荐优质服务商</p>
                <div class="btn-group mr-2 xqtags" role="group" aria-label="First group">
                    <button type="button" class="btn btn-danger btn-sm">效果图</button>
                    <button type="button" class="btn btn-danger btn-sm">自建房/别墅</button>
                    <button type="button" class="btn btn-danger btn-sm">建筑设计</button>
                    <button type="button" class="btn btn-danger btn-sm">装修设计</button>
                </div>
            </div>
            <div class="col-12">
                <div class="inputt form-group">
                    <div class="d-flex flex-row">
                        <label class="col-form-label">我需要:</label>
                        <input type="text" oninput="checkdescribe()" class="sy-describe form-control-plaintext" id="staticEmail" placeholder="效果图/自建房/别墅/装修设计">
                    </div>
                    <div class="describeerror error" style="display: none;">请填写需求或选择需求</div>
                </div>
                <div class="inputt form-group">
                    <div class="d-flex flex-row">
                        <label class="col-form-label">手机号:</label>
                        <input type="text" oninput="checkphone()" class="sy-phone form-control-plaintext" id="staticEmail" placeholder="便于及时联系您">
                    </div>
                    <div class="phoneerror error" style="display: none;">请填写正确的手机号</div>
                </div>
            </div>
            <div class=" col-12">
                <button type="submit" class="btn btn-danger btn-block mb-2 xqbtn sysqbtn">
                    <i class="icon-updata" style="display: none;"></i>
                    <span>马上为我推荐</span>
                </button>
            </div>
        </div>
        <style>
            .xqtemp{
                padding: 20px 0;
            }
            .xqtemp .hot{
                width: 16px;
                height: 26px;
                margin: 0 10px;
                margin-top: -10px;
            }
            .xqtemp .btn-group .btn{
                background: rgb(223, 89, 0,0);
                font-size: 12px;
                line-height: 16px;
                border:unset;
                height: auto;
                white-space: nowrap;
            }
            .xqtitle h3{
                font-size: 20px;
                font-weight: bold;
            }
            .xqtitle p{
                font-size: 12px;
                color: #999;
            }
            .xqtitle .btn-group{
                margin: 20px auto;
                box-shadow: 0 5px 10px rgb(0 0 0 / 10%);
                background: linear-gradient(to right, #ffa100, #ff6505);
            }
            .inputt{
                padding: 0 0 0 10px;background: #eee;
                border-radius: 5px;
            }
            .inputt label{
                width: 80px;
            }
            .inputt input{
                padding: 0 10px;
            }
            .inputt .error{
                padding-left: 75px;
                font-size: 12px;
                color: red;
                padding-bottom: 5px;
            }
            .xqbtn{
                border-radius: 30px;
                margin-top: 20px;
                color:#fff;
                font-size: 14px;
                line-height: 32px;
                border: unset;
                box-shadow: 0 5px 10px rgb(0 0 0 / 10%);
                background: linear-gradient(to right, #ffa100, #ff6505);
            }
            .icon-updata{
                width: 20px;
                height: 20px;
                display: inline-block;
                margin-bottom:-5px ;
                position: relative;
                border-radius: 50%;
                margin-right: 10px;
                border:2px solid #fff;
                border-top: unset;
                border-left: unset;
                animation: updata 1s linear infinite;
            }
            @keyframes updata{
                0%{
                    transform: rotate(0deg);
                }
                100%{
                    transform: rotate(359deg);
                }
            }
           
        </style>
        <script>
            //tags输入
            $(".xqtags").find('button').each(function(){
                $(this).click(function(){
                    $(".sy-describe").val($(this).text())
                    checkdescribe()
                })
            })
            // 验证需求
            function checkdescribe() {
                var val = $(".sy-describe").val();
                if (val=='') {
                    $(".describeerror").show();
                } else {
                    $(".describeerror").hide();
                }
            }
            // 验证手机号
            function checkphone() {
                if (!/^1[3-9]\d{9}$/.test($(".sy-phone").val())) {
                    $(".phoneerror").show();
                } else {
                    $(".phoneerror").hide();
                }
            }
            $(".sysqbtn").on('click', function() {
                // 获取需求
                var content = $(".sy-describe").val();
                // 获取电话
                var tel = $.trim($(".sy-phone").val());
                if(content==''||tel=='') {
                    checkdescribe()
                    checkphone()
                    return
                }
                $('.sysqbtn span').text('正在提交');
                $(".icon-updata").show()
                $('.sysqbtn').attr('disabled',true)
                
                var reg = /^1[3-9]\d{9}$/;
                var qq = '';
                var telephone = tel;
                var email = '';
                if (RegExp(reg).test(tel)) {
                    var data = JSON.stringify({
                        "Mobile": tel,
                        "Content": content,
                        "Source": document.title + " " + window.location.href
                    })
                    $.ajax({
                        type: 'POST',
                        url: "/api/form/1/1",
                        data: data,
                        contentType: "application/json",
                        dataType: "json",
                        success: function(result) {
                            if (result.id > 0) {
                                $('.sysqbtn span').text('提交成功，请等待客服联系！');
                            } else {
                                console.log(result);
                            }
                        },
                        error:function(error){
                            $('.sysqbtn span').text(error.responseJSON.message);
                            console.log(error);
                        },
                        complete:function(res){
                            setTimeout(function() {
                                $(".icon-updata").hide()
                                $(".sy-describe").val('');
                                $(".sy-phone").val('');
                                $('.sysqbtn span').text('马上为我推荐');
                                $('.sysqbtn').attr('disabled',false)
                            }, 5000);
                        }
                    });
                } else {
                    checkphone()
                }
            });
        </script>
    </div>
    <!--END-->
    <stl:contents channelName="广告" isImage="true" totalNum="3">
        <div class="line"></div>
        <div class="md m2">
            <div class="wrap">
                <div class="pbt disflex flex_center flex_lmr">
                    <h3>{content.Title}</h3>
                    <stl:a><i class="fa fa-angle-right"></i></stl:a>
                </div>
            </div>
            <div class="pb_w mt_10 posrelative">
                <div class="swiper-container swiper-container-public">
                    <div class="swiper-wrapper">
                        <stl:each type="imageUrl">
                            <div class="swiper-slide">
                                <stl:image class="disblock w100"></stl:image>
                            </div>
                        </stl:each>
                    </div>
                </div>
            </div>
            <div class="mt_10 textcenter">
                <stl:a class="btnbg more_a">查看详情</stl:a>
            </div>
        </div>
    </stl:contents>
    <div class="line"></div>
    <div class="md m3">
        <div class="wrap">
            <div class="pbt disflex flex_center flex_lmr">
                <h3>新人福利专区</h3>
            </div>
            <div class="m3w pdlr75">
                <stl:contents channelName='优惠券'>
                    <a href="javascript:void(0)" class="m3a disblock requireLink"><img class="disblock w100" src="{content.ImageUrl}" /></a>
                </stl:contents>
            </div>
        </div>
    </div>
    <div class="md m4 bggray">
        <div class="wrap">
            <div class="m4t activetop disflex flex_lmr flex_wrap">
                <span class="active">全部</span>
                <stl:channels channelName="服务">
                    <span>
                        <stl:channel></stl:channel>
                    </span>
                </stl:channels>
            </div>
        </div>
        <div class="service-list">
            <div class="swiper-container swiper-container-m4 swiper-no-swiping">
                <div class="swiper-wrapper">
                    <!-- 全部 -->
                    <div class="swiper-slide">
                        <div class="container">
                            <div class="row row-cols-2">
                                <stl:pageContents channelName="服务" scope="all" pageNum="10" isImage="true">
                                    <div class="col mb-3">
                                        <div class="card h-100">
                                            <img src="{content.ImageUrl}" class="card-img-top" alt="...">
                                            <div class="card-body">
                                                <p class="card-title">
                                                    <stl:a class="stretched-link">{content.Title}</stl:a>
                                                    <stl:if type="Price" op="NotIn" value="0,0.00">
                                                        <span class="float-right text-muted">￥{content.Price}</span>
                                                    </stl:if>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </stl:pageContents>
                            </div>
                            <div class="m4zk text-center mt-3">
                                <div class="load-more" data-page="1" data-pagenum="10"><img src="{stl.siteUrl}/images/m4zk_03.png" /></div>
                            </div>
                        </div>
                    </div>
                    <stl:channels channelName="服务" scope="children">
                        <div class="swiper-slide">
                            <div class="m4wrap">
                                <ul class="grid">
                                    <stl:contents scope="all" totalNum="10" isImage="true">
                                        <li class="grid-item">
                                            <img src="{content.ImageUrl}">
                                            <span>{content.Title}</span>
                                            <stl:if type="Price" op="In" value="0,0.00">
                                                <stl:no>
                                                    <div class="m4atxtb mt_5 disflex flex_lmr flex_center">
                                                        <span>￥{content.Price}</span>
                                                    </div>
                                                </stl:no>
                                            </stl:if>
                                        </li>
                                    </stl:contents>
                                </ul>
                                <div class="m4zk textcenter mt_10">
                                    <div class="load-more" data-page="1" data-pagenum="10"><img src="{stl.siteUrl}/images/m4zk_03.png" /></div>
                                </div>
                            </div>
                        </div>
                    </stl:channels>
                </div>
            </div>
        </div>
    </div>
    <stl:include file="/include/footer.html"></stl:include>
    <script src="js/index.js" type="text/javascript"></script>
    <script type="text/javascript">
        //下拉加载更多实现
        var state = true;
        var data = {
            siteId: 180,
            channelId: 0,
            checked: false,
            top: false,
            recommend: false,
            color: false,
            hot: false,
            page: 1,
            perPage: 10
        };
        var $apiToken = "24e64d3b-f9d6-4072-965a-b673bfea241b";
        //滚动条滚动的时候
        $(window).scroll(function() {
            //获取当前加载更多按钮距离顶部的距离
            var bottomsubmit = $('.service-list .swiper-slide-active .load-more').offset().top;
            //获取当前页面底部距离顶部的高度距离
            var nowtop = $(document).scrollTop() + $(window).height();
            //获取当前页数，默认第一页
            var now = $('.service-list .swiper-slide-active .load-more').attr('data-page');
            //获取总页数，分页的总页数
            var num = $('.service-list .swiper-slide-active .load-more').attr('data-pagenum');
            //当当前页面的高度大于按钮的高度的时候开始触发加载更多数据
            if (nowtop > bottomsubmit) {
                //如果为真继续执行，这个是用于防止滚动获取过多的数据情况
                if (state == true) {
                    //执行一次获取数据并停止再进来获取数据
                    state = false;

                    setTimeout(function() {
                        //当前页数++
                        now++;
                        //记录当前为第二页
                        $('.service-list .swiper-slide-active .load-more').attr('data-page', now);
                        data.page = now;
                        $.ajax({
                            //通过ajax传页数参数获取当前页数的数据
                            type: 'POST',
                            url: '/api/v1/contents',
                            headers: { //请求头
                                "X-XY-API-KEY": $apiToken,
                            },
                            data: JSON.stringify(data),
                            contentType: "application/json",
                            dataType: "json",
                            success: function(data) {
                                console.log(data);
                                //each 循环加入列
                                $('.service-list .swiper-slide-active .row').append(data);
                                //如果当前页大于等于总页数就提示没有更多数据
                                if (now >= num) {
                                    $('.service-list .swiper-slide-active .load-more').empty().text('没有更多数据');
                                    //并把状态设置为假，下次下滑滚动时不再通过ajax获取数据
                                    state = false;
                                } else {
                                    //否则继续
                                    state = true;
                                }
                            },
                            error: function() {
                                $('.service-list .swiper-slide-active .load-more').empty().text('加载错误,请刷新页面！');
                            }
                        });
                    }, 500);
                }
            }
        });
    </script>
</body>

</html>