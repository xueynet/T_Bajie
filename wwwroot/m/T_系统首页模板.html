<!DOCTYPE html>
<html>

<head>
    <stl:include file="/include/head.html"></stl:include>
</head>

<body>
    <!-- 头部的导航 -->
    <!--主体内容-->
    <div class="swiper-container swiper-container-bn">
        <div class="swiper-wrapper">
            <stl:contents channelName='banner'>
                <div class="swiper-slide">
                    <stl:a class="disblock"><img class="disblock w100" src="{content.ImageUrl}" /></stl:a>
                </div>
            </stl:contents>
        </div>
        <div class="swiper-pagination swiper-pagination-bn"></div>
    </div>
    <div class="md mt pt0">
        <div class="disflex flex_wrap">
            <stl:a channelName='算造价' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico1_03.png" />
                <p>算造价</p>
            </stl:a>
            <stl:a channelName='免费设计' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico2_03.png" />
                <p>免费设计</p>
            </stl:a>
            <stl:a channelName='别墅定制' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico3_03.png" />
                <p>别墅定制</p>
            </stl:a>
            <stl:a channelName='建房施工' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico4_03.png" />
                <p>建房施工</p>
            </stl:a>
            <stl:a channelIndex="render" class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico5_03.png" />
                <p>效果图</p>
            </stl:a>
            <stl:a channelName='户型设计' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico6_03.png" />
                <p>户型设计</p>
            </stl:a>
            <stl:a channelName='室内装修' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico7_03.png" />
                <p>室内装修</p>
            </stl:a>
            <stl:a channelName='服务' class="mta disblock textcenter"><img src="{Stl.SiteUrl}/images/mtico8_03.png" />
                <p>全部服务</p>
            </stl:a>
        </div>
    </div>
    <!--发布需求模板-->
    <div class="container">
        <div class="row xqtemp">
            <div class="xqtitle text-center col-12 mb-3">
                <h3>免费发布需求  官方推荐优质服务商</h3>
                <div class="btn-group ml-2 xqtags">
                    <div class="btn btn-sm">效果图<img class="hot" src="https://gc.zbj.com/images/hot.png"></div>
                    <div class="btn btn-sm">自建房/别墅</div>
                    <div class="btn btn-sm">建筑设计</div>
                    <div class="btn btn-sm">装修设计</div>
                </div>
            </div>
            <div class="col-12">
                <div class="inputt form-group">
                    <div class="d-flex flex-row">
                        <label class="col-form-label">我需要:</label>
                        <input type="text" oninput="checkdescribe()" class="sy-describe form-control-plaintext" id="staticEmail" placeholder="填写您的需求">
                    </div>
                    <div class="describeerror error" style="display: none;">请填写需求或选择需求</div>
                </div>
                <div class="inputt form-group">
                    <div class="d-flex flex-row">
                        <label class="col-form-label">手机号:</label>
                        <input type="number" oninput="checkphone()" class="sy-phone form-control-plaintext" id="staticEmail" placeholder="信息保护中，请放心填写">
                    </div>
                    <div class="phoneerror error" style="display: none;">请填写正确的手机号</div>
                </div>
            </div>
            <div class=" col-12">
                <button type="submit" class="btn btn-danger btn-block xqbtn sysqbtn">
                    <i class="icon-updata" style="display: none;"></i>
                    <span>马上为我推荐</span>
                </button>
            </div>
        </div>
    </div>
    <!--END-->
    <stl:contents channelName="广告" isImage="true" totalNum="3">
        <div class="line"></div>
        <div class="md m2">
            <div class="wrap">
                <div class="pbt disflex flex_center flex_lmr">
                    <h3>{content.Title}</h3>
                    <stl:a><i class="fa fa-angle-right"></i></stl:a>
                </div>
            </div>
            <div class="pb_w mt_10 posrelative">
                <div class="swiper-container swiper-container-public">
                    <div class="swiper-wrapper">
                        <stl:each type="imageUrl">
                            <div class="swiper-slide">
                                <stl:image class="disblock w100"></stl:image>
                            </div>
                        </stl:each>
                    </div>
                </div>
            </div>
            <div class="mt_10 textcenter">
                <stl:a class="btnbg more_a">查看详情</stl:a>
            </div>
        </div>
    </stl:contents>
    <div class="line"></div>
    <div class="md m3">
        <div class="wrap">
            <div class="pbt disflex flex_center flex_lmr">
                <h3>新人福利专区</h3>
            </div>
            <div class="m3w pdlr75">
                <stl:contents channelName='优惠券'>
                    <a href="javascript:void(0)" class="m3a disblock requireLink"><img class="disblock w100" src="{content.ImageUrl}" /></a>
                </stl:contents>
            </div>
        </div>
    </div>
    <div class="md m4 bggray">
        <div class="wrap">
            <div class="m4t activetop disflex flex_lmr flex_wrap">
                <span class="active">全部</span>
                <stl:channels channelName="服务">
                    <span>
                        <stl:channel></stl:channel>
                    </span>
                </stl:channels>
            </div>
        </div>
        <div class="service-list">
            <div class="swiper-container swiper-container-m4 swiper-no-swiping">
                <div class="swiper-wrapper">
                    <!-- 全部 -->
                    <div class="swiper-slide">
                        <div class="container">
                            <div class="row row-cols-2">
                                <stl:pageContents channelName="服务" scope="all" pageNum="10" isImage="true">
                                    <div class="col mb-3">
                                        <div class="card h-100">
                                            <img src="{content.ImageUrl}" class="card-img-top" alt="...">
                                            <div class="card-body">
                                                <p class="card-title">
                                                    <stl:a class="stretched-link">{content.Title}</stl:a>
                                                    <stl:if type="Price" op="NotIn" value="0,0.00">
                                                        <span class="float-right text-muted">￥{content.Price}</span>
                                                    </stl:if>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </stl:pageContents>
                            </div>
                            <div class="m4zk text-center mt-3">
                                <div class="load-more" data-page="1" data-pagenum="10"><img src="{stl.siteUrl}/images/m4zk_03.png" /></div>
                            </div>
                        </div>
                    </div>
                    <stl:channels channelName="服务" scope="children">
                        <div class="swiper-slide">
                            <div class="m4wrap">
                                <ul class="grid">
                                    <stl:contents scope="all" totalNum="10" isImage="true">
                                        <li class="grid-item">
                                            <img src="{content.ImageUrl}">
                                            <span>{content.Title}</span>
                                            <stl:if type="Price" op="In" value="0,0.00">
                                                <stl:no>
                                                    <div class="m4atxtb mt_5 disflex flex_lmr flex_center">
                                                        <span>￥{content.Price}</span>
                                                    </div>
                                                </stl:no>
                                            </stl:if>
                                        </li>
                                    </stl:contents>
                                </ul>
                                <div class="m4zk textcenter mt_10">
                                    <div class="load-more" data-page="1" data-pagenum="10"><img src="{stl.siteUrl}/images/m4zk_03.png" /></div>
                                </div>
                            </div>
                        </div>
                    </stl:channels>
                </div>
            </div>
        </div>
    </div>
    <stl:include file="/include/footer.html"></stl:include>
    <script src="js/index.js?v=143234" type="text/javascript"></script>
    <script type="text/javascript">
        //下拉加载更多实现
        var state = true;
        var data = {
            siteId: 180,
            channelId: 0,
            checked: false,
            top: false,
            recommend: false,
            color: false,
            hot: false,
            page: 1,
            perPage: 10
        };
        var $apiToken = "24e64d3b-f9d6-4072-965a-b673bfea241b";
        //滚动条滚动的时候
        $(window).scroll(function() {
            //获取当前加载更多按钮距离顶部的距离
            var bottomsubmit = $('.service-list .swiper-slide-active .load-more').offset().top;
            //获取当前页面底部距离顶部的高度距离
            var nowtop = $(document).scrollTop() + $(window).height();
            //获取当前页数，默认第一页
            var now = $('.service-list .swiper-slide-active .load-more').attr('data-page');
            //获取总页数，分页的总页数
            var num = $('.service-list .swiper-slide-active .load-more').attr('data-pagenum');
            //当当前页面的高度大于按钮的高度的时候开始触发加载更多数据
            if (nowtop > bottomsubmit) {
                //如果为真继续执行，这个是用于防止滚动获取过多的数据情况
                if (state == true) {
                    //执行一次获取数据并停止再进来获取数据
                    state = false;

                    setTimeout(function() {
                        //当前页数++
                        now++;
                        //记录当前为第二页
                        $('.service-list .swiper-slide-active .load-more').attr('data-page', now);
                        data.page = now;
                        $.ajax({
                            //通过ajax传页数参数获取当前页数的数据
                            type: 'POST',
                            url: '/api/v1/contents',
                            headers: { //请求头
                                "X-XY-API-KEY": $apiToken,
                            },
                            data: JSON.stringify(data),
                            contentType: "application/json",
                            dataType: "json",
                            success: function(data) {
                                console.log(data);
                                //each 循环加入列
                                $('.service-list .swiper-slide-active .row').append(data);
                                //如果当前页大于等于总页数就提示没有更多数据
                                if (now >= num) {
                                    $('.service-list .swiper-slide-active .load-more').empty().text('没有更多数据');
                                    //并把状态设置为假，下次下滑滚动时不再通过ajax获取数据
                                    state = false;
                                } else {
                                    //否则继续
                                    state = true;
                                }
                            },
                            error: function() {
                                $('.service-list .swiper-slide-active .load-more').empty().text('加载错误,请刷新页面！');
                            }
                        });
                    }, 500);
                }
            }
        });
    </script>
</body>

</html>